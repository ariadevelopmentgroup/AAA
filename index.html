<!DOCTYPE html>
<html lang="hy">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Ռեսպոնսիվ CMS</title>
  <script src="https://cdn.jsdelivr.net/npm/react@18.2.0/umd/react.production.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/react-dom@18.2.0/umd/react-dom.production.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/axios@1.4.0/dist/axios.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/react-quill@2.0.0/dist/react-quill.js"></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
  <link href="https://cdn.jsdelivr.net/npm/react-quill@2.0.0/dist/quill.snow.css" rel="stylesheet">
  <style>
    body { 
      background-color: #1a1a1a; 
      color: #ffffff; 
      font-family: Arial, sans-serif; 
    }
    .ql-editor { 
      background-color: #2d2d2d; 
      color: #ffffff; 
      min-height: 200px; 
    }
    .ql-toolbar { 
      background-color: #1a1a1a; 
    }
    .custom-button { 
      background-color: #ffffff; 
      color: #000000; 
      padding: 8px 16px; 
      border-radius: 4px; 
      transition: background-color 0.3s; 
    }
    .custom-button:hover { 
      background-color: #e5e5e5; 
    }
    .sidebar { 
      background-color: #2d2d2d; 
      padding: 20px; 
      min-height: 100vh; 
    }
    .content-area { 
      padding: 20px; 
    }
    /* Responsive Design */
    @media (max-width: 640px) { 
      .container { padding: 10px; } 
      .sidebar { min-height: auto; } 
      .grid-cols-1 { grid-template-columns: 1fr; } 
    }
    @media (min-width: 641px) and (max-width: 768px) { 
      .container { padding: 15px; } 
      .grid-cols-2 { grid-template-columns: repeat(2, 1fr); } 
    }
    @media (min-width: 769px) and (max-width: 1024px) { 
      .container { padding: 20px; } 
      .grid-cols-3 { grid-template-columns: repeat(3, 1fr); } 
    }
    @media (min-width: 1025px) and (max-width: 1440px) { 
      .container { padding: 25px; } 
    }
    @media (min-width: 1441px) { 
      .container { padding: 30px; } 
    }
  </style>
</head>
<body>
  <div id="root"></div>
  <script type="text/babel">
    const { useState, useEffect } = React;

    const CMSApp = () => {
      const [isAuthenticated, setIsAuthenticated] = useState(false);
      const [content, setContent] = useState([]);
      const [newContent, setNewContent] = useState('');
      const [searchTerm, setSearchTerm] = useState('');
      const [selectedFiles, setSelectedFiles] = useState([]);
      const [scheduledPosts, setScheduledPosts] = useState([]);
      const [comments, setComments] = useState([]);
      const [users, setUsers] = useState([]);
      const [analytics, setAnalytics] = useState(null);
      const [contentTypes, setContentTypes] = useState(['post', 'page']);

      // GitHub Authentication
      const handleGitHubLogin = () => {
        window.location.href = 'https://github.com/login/oauth/authorize?client_id=YOUR_GITHUB_CLIENT_ID&scope=repo';
      };

      // Fetch content from GitHub
      const fetchContent = async () => {
        try {
          const response = await axios.get('https://api.github.com/repos/OWNER/REPO/contents/content', {
            headers: { Authorization: 'Bearer YOUR_GITHUB_TOKEN' }
          });
          setContent(Array.isArray(response.data) ? response.data : []);
        } catch (error) {
          console.error('Error fetching content:', error);
        }
      };

      // Save content to GitHub
      const saveContent = async () => {
        try {
          await axios.put('https://api.github.com/repos/OWNER/REPO/contents/content/new-file.md', {
            message: 'Add new content',
            content: btoa(newContent),
            branch: 'main'
          }, {
            headers: { Authorization: 'Bearer YOUR_GITHUB_TOKEN' }
          });
          fetchContent();
          setNewContent('');
        } catch (error) {
          console.error('Error saving content:', error);
        }
      };

      // Visual Editor with React Quill
      const handleEditorChange = (value) => {
        setNewContent(value);
      };

      // Media Manager
      const handleFileUpload = (event) => {
        const files = Array.from(event.target.files);
        setSelectedFiles(files);
        console.log('Uploading files to storage (AWS S3/Cloudflare R2):', files);
      };

      // Search Functionality
      const filteredContent = content.filter(item =>
        item.name && item.name.toLowerCase().includes(searchTerm.toLowerCase())
      );

      // Schedule Content
      const scheduleContent = (content, date) => {
        if (content && date) {
          setScheduledPosts([...scheduledPosts, { content, date }]);
          console.log('Scheduled content:', { content, date });
        }
      };

      // Invite Users
      const inviteUser = (email) => {
        if (email) {
          setUsers([...users, { email, role: 'editor' }]);
          console.log(`Invited user: ${email}`);
        }
      };

      // Permissions
      const updatePermissions = (user, role) => {
        setUsers(users.map(u => u.email === user.email ? { ...u, role } : u));
      };

      // Analytics Integration
      const fetchAnalytics = () => {
        setAnalytics({ pageViews: 1000, uniqueVisitors: 500 });
        console.log('Fetched analytics data');
      };

      // Comments
      const addComment = (contentId, comment) => {
        if (contentId && comment) {
          setComments([...comments, { contentId, comment, user: 'currentUser' }]);
        }
      };

      // Content Type Configuration
      const addContentType = (type) => {
        if (type && !contentTypes.includes(type)) {
          setContentTypes([...contentTypes, type]);
        }
      };

      useEffect(() => {
        if (isAuthenticated) {
          fetchContent();
          fetchAnalytics();
        }
      }, [isAuthenticated]);

      return (
        <div className="flex min-h-screen">
          {/* Sidebar */}
          {isAuthenticated && (
            <div className="sidebar w-full sm:w-64">
              <h2 className="text-xl font-bold mb-4">CMS</h2>
              <ul>
                <li className="mb-2"><a href="#content" className="hover:underline">Բովանդակություն</a></li>
                <li className="mb-2"><a href="#media" className="hover:underline">Մեդիա</a></li>
                <li className="mb-2"><a href="#schedule" className="hover:underline">Հաշվարկ</a></li>
                <li className="mb-2"><a href="#users" className="hover:underline">Օգտատերեր</a></li>
                <li className="mb-2"><a href="#analytics" className="hover:underline">Վերլուծություն</a></li>
              </ul>
            </div>
          )}
          {/* Main Content */}
          <div className="content-area flex-1 container mx-auto p-4">
            {!isAuthenticated ? (
              <div className="flex justify-center items-center h-screen">
                <button onClick={handleGitHubLogin} className="custom-button">Մուտք գործել GitHub-ով</button>
              </div>
            ) : (
              <div className="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4">
                {/* Visual Editor */}
                <div className="bg-gray-800 p-4 rounded" id="content">
                  <h2 className="text-xl font-bold mb-2">Տեքստային խմբագրիչ</h2>
                  <ReactQuill theme="snow" value={newContent} onChange={handleEditorChange} />
                  <button onClick={saveContent} className="custom-button mt-2">Պահպանել</button>
                </div>

                {/* Media Manager */}
                <div className="bg-gray-800 p-4 rounded" id="media">
                  <h2 className="text-xl font-bold mb-2">Մեդիա կառավարիչ</h2>
                  <input type="file" multiple onChange={handleFileUpload} className="mb-2 text-white" />
                  <div>
                    {selectedFiles.map((file, index) => (
                      <p key={index} className="text-sm">{file.name}</p>
                    ))}
                  </div>
                </div>

                {/* Search */}
                <div className="bg-gray-800 p-4 rounded">
                  <h2 className="text-xl font-bold mb-2">Որոնում</h2>
                  <input
                    type="text"
                    placeholder="Որոնել բովանդակություն..."
                    value={searchTerm}
                    onChange={(e) => setSearchTerm(e.target.value)}
                    className="w-full p-2 bg-gray-700 rounded text-white"
                  />
                  <ul className="mt-2">
                    {filteredContent.map(item => (
                      <li key={item.sha || item.name} className="text-sm">{item.name}</li>
                    ))}
                  </ul>
                </div>

                {/* Scheduling */}
                <div className="bg-gray-800 p-4 rounded" id="schedule">
                  <h2 className="text-xl font-bold mb-2">Հաշվարկված հրապարակում</h2>
                  <input type="datetime-local" className="w-full p-2 bg-gray-700 rounded text-white mb-2" />
                  <button onClick={() => scheduleContent(newContent, new Date())} className="custom-button">Հաշվարկել</button>
                </div>

                {/* Permissions */}
                <div className="bg-gray-800 p-4 rounded" id="users">
                  <h2 className="text-xl font-bold mb-2">Թույլտվություններ</h2>
                  {users.map(user => (
                    <div key={user.email} className="flex justify-between mb-2">
                      <span className="text-sm">{user.email}</span>
                      <select
                        value={user.role}
                        onChange={(e) => updatePermissions(user, e.target.value)}
                        className="bg-gray-700 text-white p-1 rounded text-sm"
                      >
                        <option value="editor">Խմբագիր</option>
                        <option value="admin">Ադմին</option>
                      </select>
                    </div>
                  ))}
                  <input
                    type="email"
                    placeholder="Հաշիվը հրավիրելու համար"
                    onChange={(e) => inviteUser(e.target.value)}
                    className="w-full p-2 bg-gray-700 rounded text-white mt-2"
                  />
                </div>

                {/* Analytics */}
                <div className="bg-gray-800 p-4 rounded" id="analytics">
                  <h2 className="text-xl font-bold mb-2">Վերլուծություն</h2>
                  {analytics ? (
                    <div className="text-sm">
                      <p>Էջի դիտումներ: {analytics.pageViews}</p>
                      <p>Եզակի այցելուներ: {analytics.uniqueVisitors}</p>
                    </div>
                  ) : (
                    <p>Տվյալներ չկան</p>
                  )}
                </div>

                {/* Comments */}
                <div className="bg-gray-800 p-4 rounded">
                  <h2 className="text-xl font-bold mb-2">Մեկնաբանություններ</h2>
                  <input
                    type="text"
                    placeholder="Ավելացնել մեկնաբանություն..."
                    onChange={(e) => addComment('contentId', e.target.value)}
                    className="w-full p-2 bg-gray-700 rounded text-white mb-2"
                  />
                  {comments.map((comment, index) => (
                    <p key={index} className="text-sm">{comment.comment} - {comment.user}</p>
                  ))}
                </div>

                {/* Content Types */}
                <div className="bg-gray-800 p-4 rounded">
                  <h2 className="text-xl font-bold mb-2">Բովանդակության տեսակներ</h2>
                  <input
                    type="text"
                    placeholder="Ավելացնել նոր տեսակ..."
                    onChange={(e) => addContentType(e.target.value)}
                    className="w-full p-2 bg-gray-700 rounded text-white mb-2"
                  />
                  <ul>
                    {contentTypes.map((type, index) => (
                      <li key={index} className="text-sm">{type}</li>
                    ))}
                  </ul>
                </div>
              </div>
            )}
          </div>
        </div>
      );
    };

    ReactDOM.render(<CMSApp />, document.getElementById('root'));
  </script>
</body>
</html>
